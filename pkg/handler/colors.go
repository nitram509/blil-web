package handler

import (
	"encoding/hex"
	"fmt"
	"image/color"
	"math/rand"
	"regexp"
	"strings"
	"time"
)

var Colors map[string]*color.RGBA

func init() {
	Colors = make(map[string]*color.RGBA)
	Colors["aliceblue"] = &color.RGBA{0xf0, 0xf8, 0xff, 0xFF}
	Colors["antiquewhite"] = &color.RGBA{0xfa, 0xeb, 0xd7, 0xFF}
	Colors["aqua"] = &color.RGBA{0x00, 0xff, 0xff, 0xFF}
	Colors["aquamarine"] = &color.RGBA{0x7f, 0xff, 0xd4, 0xFF}
	Colors["azure"] = &color.RGBA{0xf0, 0xff, 0xff, 0xFF}
	Colors["beige"] = &color.RGBA{0xf5, 0xf5, 0xdc, 0xFF}
	Colors["bisque"] = &color.RGBA{0xff, 0xe4, 0xc4, 0xFF}
	Colors["black"] = &color.RGBA{0x00, 0x00, 0x00, 0xFF}
	Colors["blanchedalmond"] = &color.RGBA{0xff, 0xeb, 0xcd, 0xFF}
	Colors["blue"] = &color.RGBA{0x00, 0x00, 0xff, 0xFF}
	Colors["blueviolet"] = &color.RGBA{0x8a, 0x2b, 0xe2, 0xFF}
	Colors["brown"] = &color.RGBA{0xa5, 0x2a, 0x2a, 0xFF}
	Colors["burlywood"] = &color.RGBA{0xde, 0xb8, 0x87, 0xFF}
	Colors["cadetblue"] = &color.RGBA{0x5f, 0x9e, 0xa0, 0xFF}
	Colors["chartreuse"] = &color.RGBA{0x7f, 0xff, 0x00, 0xFF}
	Colors["chocolate"] = &color.RGBA{0xd2, 0x69, 0x1e, 0xFF}
	Colors["coral"] = &color.RGBA{0xff, 0x7f, 0x50, 0xFF}
	Colors["cornflowerblue"] = &color.RGBA{0x64, 0x95, 0xed, 0xFF}
	Colors["cornsilk"] = &color.RGBA{0xff, 0xf8, 0xdc, 0xFF}
	Colors["crimson"] = &color.RGBA{0xdc, 0x14, 0x3c, 0xFF}
	Colors["cyan"] = &color.RGBA{0x00, 0xff, 0xff, 0xFF}
	Colors["darkblue"] = &color.RGBA{0x00, 0x00, 0x8b, 0xFF}
	Colors["darkcyan"] = &color.RGBA{0x00, 0x8b, 0x8b, 0xFF}
	Colors["darkgoldenrod"] = &color.RGBA{0xb8, 0x86, 0x0b, 0xFF}
	Colors["darkgray"] = &color.RGBA{0xa9, 0xa9, 0xa9, 0xFF}
	Colors["darkgrey"] = &color.RGBA{0xa9, 0xa9, 0xa9, 0xFF}
	Colors["darkgreen"] = &color.RGBA{0x00, 0x64, 0x00, 0xFF}
	Colors["darkkhaki"] = &color.RGBA{0xbd, 0xb7, 0x6b, 0xFF}
	Colors["darkmagenta"] = &color.RGBA{0x8b, 0x00, 0x8b, 0xFF}
	Colors["darkolivegreen"] = &color.RGBA{0x55, 0x6b, 0x2f, 0xFF}
	Colors["darkorange"] = &color.RGBA{0xff, 0x8c, 0x00, 0xFF}
	Colors["darkorchid"] = &color.RGBA{0x99, 0x32, 0xcc, 0xFF}
	Colors["darkred"] = &color.RGBA{0x8b, 0x00, 0x00, 0xFF}
	Colors["darksalmon"] = &color.RGBA{0xe9, 0x96, 0x7a, 0xFF}
	Colors["darkseagreen"] = &color.RGBA{0x8f, 0xbc, 0x8f, 0xFF}
	Colors["darkslateblue"] = &color.RGBA{0x48, 0x3d, 0x8b, 0xFF}
	Colors["darkslategray"] = &color.RGBA{0x2f, 0x4f, 0x4f, 0xFF}
	Colors["darkslategrey"] = &color.RGBA{0x2f, 0x4f, 0x4f, 0xFF}
	Colors["darkturquoise"] = &color.RGBA{0x00, 0xce, 0xd1, 0xFF}
	Colors["darkviolet"] = &color.RGBA{0x94, 0x00, 0xd3, 0xFF}
	Colors["deeppink"] = &color.RGBA{0xff, 0x14, 0x93, 0xFF}
	Colors["deepskyblue"] = &color.RGBA{0x00, 0xbf, 0xff, 0xFF}
	Colors["dimgray"] = &color.RGBA{0x69, 0x69, 0x69, 0xFF}
	Colors["dimgrey"] = &color.RGBA{0x69, 0x69, 0x69, 0xFF}
	Colors["dodgerblue"] = &color.RGBA{0x1e, 0x90, 0xff, 0xFF}
	Colors["firebrick"] = &color.RGBA{0xb2, 0x22, 0x22, 0xFF}
	Colors["floralwhite"] = &color.RGBA{0xff, 0xfa, 0xf0, 0xFF}
	Colors["forestgreen"] = &color.RGBA{0x22, 0x8b, 0x22, 0xFF}
	Colors["fuchsia"] = &color.RGBA{0xff, 0x00, 0xff, 0xFF}
	Colors["gainsboro"] = &color.RGBA{0xdc, 0xdc, 0xdc, 0xFF}
	Colors["ghostwhite"] = &color.RGBA{0xf8, 0xf8, 0xff, 0xFF}
	Colors["gold"] = &color.RGBA{0xff, 0xd7, 0x00, 0xFF}
	Colors["goldenrod"] = &color.RGBA{0xda, 0xa5, 0x20, 0xFF}
	Colors["gray"] = &color.RGBA{0x80, 0x80, 0x80, 0xFF}
	Colors["grey"] = &color.RGBA{0x80, 0x80, 0x80, 0xFF}
	Colors["green"] = &color.RGBA{0x00, 0x80, 0x00, 0xFF}
	Colors["greenyellow"] = &color.RGBA{0xad, 0xff, 0x2f, 0xFF}
	Colors["honeydew"] = &color.RGBA{0xf0, 0xff, 0xf0, 0xFF}
	Colors["hotpink"] = &color.RGBA{0xff, 0x69, 0xb4, 0xFF}
	Colors["indianred"] = &color.RGBA{0xcd, 0x5c, 0x5c, 0xFF}
	Colors["indigo"] = &color.RGBA{0x4b, 0x00, 0x82, 0xFF}
	Colors["ivory"] = &color.RGBA{0xff, 0xff, 0xf0, 0xFF}
	Colors["khaki"] = &color.RGBA{0xf0, 0xe6, 0x8c, 0xFF}
	Colors["lavender"] = &color.RGBA{0xe6, 0xe6, 0xfa, 0xFF}
	Colors["lavenderblush"] = &color.RGBA{0xff, 0xf0, 0xf5, 0xFF}
	Colors["lawngreen"] = &color.RGBA{0x7c, 0xfc, 0x00, 0xFF}
	Colors["lemonchiffon"] = &color.RGBA{0xff, 0xfa, 0xcd, 0xFF}
	Colors["lightblue"] = &color.RGBA{0xad, 0xd8, 0xe6, 0xFF}
	Colors["lightcoral"] = &color.RGBA{0xf0, 0x80, 0x80, 0xFF}
	Colors["lightcyan"] = &color.RGBA{0xe0, 0xff, 0xff, 0xFF}
	Colors["lightgoldenrodyellow"] = &color.RGBA{0xfa, 0xfa, 0xd2, 0xFF}
	Colors["lightgray"] = &color.RGBA{0xd3, 0xd3, 0xd3, 0xFF}
	Colors["lightgrey"] = &color.RGBA{0xd3, 0xd3, 0xd3, 0xFF}
	Colors["lightgreen"] = &color.RGBA{0x90, 0xee, 0x90, 0xFF}
	Colors["lightpink"] = &color.RGBA{0xff, 0xb6, 0xc1, 0xFF}
	Colors["lightsalmon"] = &color.RGBA{0xff, 0xa0, 0x7a, 0xFF}
	Colors["lightseagreen"] = &color.RGBA{0x20, 0xb2, 0xaa, 0xFF}
	Colors["lightskyblue"] = &color.RGBA{0x87, 0xce, 0xfa, 0xFF}
	Colors["lightslategray"] = &color.RGBA{0x77, 0x88, 0x99, 0xFF}
	Colors["lightslategrey"] = &color.RGBA{0x77, 0x88, 0x99, 0xFF}
	Colors["lightsteelblue"] = &color.RGBA{0xb0, 0xc4, 0xde, 0xFF}
	Colors["lightyellow"] = &color.RGBA{0xff, 0xff, 0xe0, 0xFF}
	Colors["lime"] = &color.RGBA{0x00, 0xff, 0x00, 0xFF}
	Colors["limegreen"] = &color.RGBA{0x32, 0xcd, 0x32, 0xFF}
	Colors["linen"] = &color.RGBA{0xfa, 0xf0, 0xe6, 0xFF}
	Colors["magenta"] = &color.RGBA{0xff, 0x00, 0xff, 0xFF}
	Colors["maroon"] = &color.RGBA{0x80, 0x00, 0x00, 0xFF}
	Colors["mediumaquamarine"] = &color.RGBA{0x66, 0xcd, 0xaa, 0xFF}
	Colors["mediumblue"] = &color.RGBA{0x00, 0x00, 0xcd, 0xFF}
	Colors["mediumorchid"] = &color.RGBA{0xba, 0x55, 0xd3, 0xFF}
	Colors["mediumpurple"] = &color.RGBA{0x93, 0x70, 0xd8, 0xFF}
	Colors["mediumseagreen"] = &color.RGBA{0x3c, 0xb3, 0x71, 0xFF}
	Colors["mediumslateblue"] = &color.RGBA{0x7b, 0x68, 0xee, 0xFF}
	Colors["mediumspringgreen"] = &color.RGBA{0x00, 0xfa, 0x9a, 0xFF}
	Colors["mediumturquoise"] = &color.RGBA{0x48, 0xd1, 0xcc, 0xFF}
	Colors["mediumvioletred"] = &color.RGBA{0xc7, 0x15, 0x85, 0xFF}
	Colors["midnightblue"] = &color.RGBA{0x19, 0x19, 0x70, 0xFF}
	Colors["mintcream"] = &color.RGBA{0xf5, 0xff, 0xfa, 0xFF}
	Colors["mistyrose"] = &color.RGBA{0xff, 0xe4, 0xe1, 0xFF}
	Colors["moccasin"] = &color.RGBA{0xff, 0xe4, 0xb5, 0xFF}
	Colors["navajowhite"] = &color.RGBA{0xff, 0xde, 0xad, 0xFF}
	Colors["navy"] = &color.RGBA{0x00, 0x00, 0x80, 0xFF}
	Colors["oldlace"] = &color.RGBA{0xfd, 0xf5, 0xe6, 0xFF}
	Colors["olive"] = &color.RGBA{0x80, 0x80, 0x00, 0xFF}
	Colors["olivedrab"] = &color.RGBA{0x6b, 0x8e, 0x23, 0xFF}
	Colors["orange"] = &color.RGBA{0xff, 0xa5, 0x00, 0xFF}
	Colors["orangered"] = &color.RGBA{0xff, 0x45, 0x00, 0xFF}
	Colors["orchid"] = &color.RGBA{0xda, 0x70, 0xd6, 0xFF}
	Colors["palegoldenrod"] = &color.RGBA{0xee, 0xe8, 0xaa, 0xFF}
	Colors["palegreen"] = &color.RGBA{0x98, 0xfb, 0x98, 0xFF}
	Colors["paleturquoise"] = &color.RGBA{0xaf, 0xee, 0xee, 0xFF}
	Colors["palevioletred"] = &color.RGBA{0xd8, 0x70, 0x93, 0xFF}
	Colors["papayawhip"] = &color.RGBA{0xff, 0xef, 0xd5, 0xFF}
	Colors["peachpuff"] = &color.RGBA{0xff, 0xda, 0xb9, 0xFF}
	Colors["peru"] = &color.RGBA{0xcd, 0x85, 0x3f, 0xFF}
	Colors["pink"] = &color.RGBA{0xff, 0xc0, 0xcb, 0xFF}
	Colors["plum"] = &color.RGBA{0xdd, 0xa0, 0xdd, 0xFF}
	Colors["powderblue"] = &color.RGBA{0xb0, 0xe0, 0xe6, 0xFF}
	Colors["purple"] = &color.RGBA{0x80, 0x00, 0x80, 0xFF}
	Colors["red"] = &color.RGBA{0xff, 0x00, 0x00, 0xFF}
	Colors["rosybrown"] = &color.RGBA{0xbc, 0x8f, 0x8f, 0xFF}
	Colors["royalblue"] = &color.RGBA{0x41, 0x69, 0xe1, 0xFF}
	Colors["saddlebrown"] = &color.RGBA{0x8b, 0x45, 0x13, 0xFF}
	Colors["salmon"] = &color.RGBA{0xfa, 0x80, 0x72, 0xFF}
	Colors["sandybrown"] = &color.RGBA{0xf4, 0xa4, 0x60, 0xFF}
	Colors["seagreen"] = &color.RGBA{0x2e, 0x8b, 0x57, 0xFF}
	Colors["seashell"] = &color.RGBA{0xff, 0xf5, 0xee, 0xFF}
	Colors["sienna"] = &color.RGBA{0xa0, 0x52, 0x2d, 0xFF}
	Colors["silver"] = &color.RGBA{0xc0, 0xc0, 0xc0, 0xFF}
	Colors["skyblue"] = &color.RGBA{0x87, 0xce, 0xeb, 0xFF}
	Colors["slateblue"] = &color.RGBA{0x6a, 0x5a, 0xcd, 0xFF}
	Colors["slategray"] = &color.RGBA{0x70, 0x80, 0x90, 0xFF}
	Colors["slategrey"] = &color.RGBA{0x70, 0x80, 0x90, 0xFF}
	Colors["snow"] = &color.RGBA{0xff, 0xfa, 0xfa, 0xFF}
	Colors["springgreen"] = &color.RGBA{0x00, 0xff, 0x7f, 0xFF}
	Colors["steelblue"] = &color.RGBA{0x46, 0x82, 0xb4, 0xFF}
	Colors["tan"] = &color.RGBA{0xd2, 0xb4, 0x8c, 0xFF}
	Colors["teal"] = &color.RGBA{0x00, 0x80, 0x80, 0xFF}
	Colors["thistle"] = &color.RGBA{0xd8, 0xbf, 0xd8, 0xFF}
	Colors["tomato"] = &color.RGBA{0xff, 0x63, 0x47, 0xFF}
	Colors["turquoise"] = &color.RGBA{0x40, 0xe0, 0xd0, 0xFF}
	Colors["violet"] = &color.RGBA{0xee, 0x82, 0xee, 0xFF}
	Colors["wheat"] = &color.RGBA{0xf5, 0xde, 0xb3, 0xFF}
	Colors["white"] = &color.RGBA{0xff, 0xff, 0xff, 0xFF}
	Colors["whitesmoke"] = &color.RGBA{0xf5, 0xf5, 0xf5, 0xFF}
	Colors["yellow"] = &color.RGBA{0xff, 0xff, 0x00, 0xFF}
	Colors["yellowgreen"] = &color.RGBA{0x9a, 0xcd, 0x32, 0xFF}
}

func MapColor(colorString string) color.Color {
	col := strings.ToLower(colorString)
	if col == "random" {
		rand.Seed(time.Now().UnixNano())
		return color.RGBA{uint8(rand.Int()), uint8(rand.Int()), uint8(rand.Int()), 0xFF}
	}
	if col == "off" {
		return color.Black
	}
	if Colors[col] != nil {
		return Colors[col]
	}
	validHexCode := regexp.MustCompile(`^#?([a-f0-9]{6})$`)
	if validHexCode.MatchString(col) {
		hexStr := validHexCode.FindStringSubmatch(col)
		bytes, err := hex.DecodeString(hexStr[1])
		if err != nil {
			fmt.Printf("invalid color code '%s'. use '#rrggbb' instead", hexStr[1])
			return nil
		}
		return color.RGBA{uint8(bytes[0]), uint8(bytes[1]), uint8(bytes[2]), 0xFF}
	}
	return nil
}
